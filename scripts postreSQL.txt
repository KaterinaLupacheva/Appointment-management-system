CREATE USER beautysalon WITH ENCRYPTED PASSWORD 'beautysalon';

CREATE database beautysalon_repository;

GRANT ALL PRIVILEGES ON database beautysalon_repository TO beautysalon;

CREATE schema beauty_salon;

GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA beauty_salon TO beautysalon;

SET FOREIGN_KEY_CHECKS = 0;


DROP TABLE IF EXISTS beauty_salon.client;

CREATE TABLE beauty_salon.client (
  id integer not null generated always as identity,
  first_name varchar(45) DEFAULT NULL,
  last_name varchar(45) DEFAULT NULL,
  email varchar(45) DEFAULT NULL,
  phone varchar(45) NOT NULL,

PRIMARY KEY (id)

);


DROP TABLE IF EXISTS beauty_salon.service;

CREATE TABLE beauty_salon.service (
  id integer not null generated always as identity,
  title varchar(100) NOT NULL,
  duration int NOT NULL,

PRIMARY KEY (id)

);

DROP TABLE IF EXISTS beauty_salon.master;

CREATE TABLE beauty_salon.master (
  id integer not null generated always as identity,
  first_name varchar(45) NOT NULL,
  last_name varchar(45) NOT NULL,
  main_service varchar(100) NOT NULL,
PRIMARY KEY (id)
) ;

DROP TABLE IF EXISTS beauty_salon.service_master;

CREATE TABLE beauty_salon.service_master (
  service_id integer not null generated by default as identity,
  master_id integer not null generated by default as identity,

CONSTRAINT FK_SERVICE_01 FOREIGN KEY (service_id)
REFERENCES beauty_salon.service (id)
ON DELETE NO ACTION ON UPDATE NO ACTION,

CONSTRAINT FK_MASTER_01 FOREIGN KEY (master_id)
REFERENCES beauty_salon.master (id)
ON DELETE NO ACTION ON UPDATE NO ACTION
);

DROP TABLE IF EXISTS beauty_salon.schedule;

CREATE TABLE beauty_salon.schedule (
  id integer not null generated always as identity,
  day date NOT NULL,
  start_time time DEFAULT NULL,
  end_time time DEFAULT NULL,
  master_id integer DEFAULT NULL,

PRIMARY KEY (id),

CONSTRAINT FK_MASTER_02
FOREIGN KEY (master_id)
REFERENCES beauty_salon.master (id)

ON DELETE CASCADE
);

DROP TABLE IF EXISTS beauty_salon.appointment;

CREATE TABLE beauty_salon.appointment (
  id integer not null generated always as identity,
  day date NOT NULL,
  start_time time DEFAULT NULL,
  client_id integer DEFAULT NULL,
  service_id integer DEFAULT NULL,
  master_id integer DEFAULT NULL,
  comment text DEFAULT NULL,

PRIMARY KEY (id),

CONSTRAINT FK_CLIENT
FOREIGN KEY (client_id)
REFERENCES beauty_salon.client (id)
ON DELETE NO ACTION ON UPDATE NO ACTION,

CONSTRAINT FK_SERVICE
FOREIGN KEY (service_id)
REFERENCES beauty_salon.service (id)
ON DELETE NO ACTION ON UPDATE NO ACTION,

CONSTRAINT FK_MASTER
FOREIGN KEY (master_id)
REFERENCES beauty_salon.master (id)
ON DELETE CASCADE

);

DROP TABLE IF EXISTS beauty_salon.schedule_details;

CREATE TABLE beauty_salon.schedule_details (
  id integer not null generated always as identity,
  schedule_id integer DEFAULT NULL,
  slot time DEFAULT NULL,
  available varchar(3) DEFAULT 'YES',

PRIMARY KEY (id),

CONSTRAINT FK_SCHEDULE_01
FOREIGN KEY (schedule_id)
REFERENCES beauty_salon.schedule (id)

ON DELETE CASCADE ON UPDATE NO ACTION
);

SET FOREIGN_KEY_CHECKS = 1;

